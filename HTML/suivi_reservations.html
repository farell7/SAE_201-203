<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi des réservations - Université Eiffel</title>
    <link rel="stylesheet" href="../CSS/styleadmin.css">
</head>
<body>
    <div class="container">
        <h1>Suivi des réservations</h1>
        <div id="error-message" class="error" style="display: none;"></div>
        <div id="success-message" class="success" style="display: none;"></div>

        <!-- Réservations de matériel -->
        <div class="table-section">
            <h2>Historique des réservations de matériel</h2>
            <table>
                <thead>
                    <tr>
                        <th>Matériel</th>
                        <th>Type</th>
                        <th>Emprunteur</th>
                        <th>Date début</th>
                        <th>Date fin</th>
                        <th>Date validation</th>
                        <th>Signature Admin</th>
                        <th>Commentaire</th>
                    </tr>
                </thead>
                <tbody id="materielTableBody">
                    <!-- Les réservations de matériel seront chargées ici dynamiquement -->
                </tbody>
            </table>
        </div>

        <!-- Réservations de salles -->
        <div class="table-section">
            <h2>Historique des réservations de salles</h2>
            <table>
                <thead>
                    <tr>
                        <th>Salle</th>
                        <th>Capacité</th>
                        <th>Réservé par</th>
                        <th>Date début</th>
                        <th>Date fin</th>
                        <th>Date validation</th>
                        <th>Signature Admin</th>
                        <th>Commentaire</th>
                    </tr>
                </thead>
                <tbody id="sallesTableBody">
                    <!-- Les réservations de salles seront chargées ici dynamiquement -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Charger les réservations au chargement de la page
        window.onload = function() {
            loadReservations();
        };

        // Charger les réservations
        function loadReservations() {
            // Charger les réservations de matériel
            fetch('../PHP/suivi_reservations.php?action=list_materiel')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showError(data.error);
                    } else {
                        const tbody = document.getElementById('materielTableBody');
                        tbody.innerHTML = '';
                        
                        if (data.reservations.length === 0) {
                            tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Aucune réservation de matériel validée trouvée</td></tr>';
                        } else {
                            data.reservations.forEach(reservation => {
                                const tr = document.createElement('tr');
                                tr.innerHTML = `
                                    <td>${reservation.materiel_nom}</td>
                                    <td>${reservation.materiel_type}</td>
                                    <td>${reservation.user_nom && reservation.user_prenom ? 
                                        `${reservation.user_prenom} ${reservation.user_nom}` : 
                                        'Utilisateur inconnu'}</td>
                                    <td>${formatDate(reservation.date_debut)}</td>
                                    <td>${formatDate(reservation.date_fin)}</td>
                                    <td>${reservation.date_signature ? formatDate(reservation.date_signature) : '-'}</td>
                                    <td>${reservation.signature_admin || '-'}</td>
                                    <td>${reservation.commentaire || '-'}</td>
                                `;
                                tbody.appendChild(tr);
                            });
                        }
                    }
                })
                .catch(error => {
                    showError('Erreur lors du chargement des réservations de matériel');
                });

            // Charger les réservations de salles
            fetch('../PHP/suivi_reservations.php?action=list_salles')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showError(data.error);
                    } else {
                        const tbody = document.getElementById('sallesTableBody');
                        tbody.innerHTML = '';
                        
                        if (data.reservations.length === 0) {
                            tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Aucune réservation de salle validée trouvée</td></tr>';
                        } else {
                            data.reservations.forEach(reservation => {
                                const tr = document.createElement('tr');
                                tr.innerHTML = `
                                    <td>${reservation.salle_nom}</td>
                                    <td>${reservation.capacite} personnes</td>
                                    <td>${reservation.user_nom && reservation.user_prenom ? 
                                        `${reservation.user_prenom} ${reservation.user_nom}` : 
                                        'Utilisateur inconnu'}</td>
                                    <td>${formatDate(reservation.date_debut)}</td>
                                    <td>${formatDate(reservation.date_fin)}</td>
                                    <td>${reservation.date_signature ? formatDate(reservation.date_signature) : '-'}</td>
                                    <td>${reservation.signature_admin || '-'}</td>
                                    <td>${reservation.commentaire || '-'}</td>
                                `;
                                tbody.appendChild(tr);
                            });
                        }
                    }
                })
                .catch(error => {
                    showError('Erreur lors du chargement des réservations de salles');
                });
        }

        // Fonctions utilitaires
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('success-message').style.display = 'none';
            setTimeout(() => { errorDiv.style.display = 'none'; }, 3000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('success-message');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            document.getElementById('error-message').style.display = 'none';
            setTimeout(() => { successDiv.style.display = 'none'; }, 3000);
        }
    </script>
</body>
</html> 